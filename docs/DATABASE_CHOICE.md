# 資料庫選擇：Neon vs D1

## 為什麼選擇 Neon 而不是 Cloudflare D1？

本專案最初設計使用 Cloudflare D1，但根據需求改用 Neon PostgreSQL。以下是兩者的比較：

## Cloudflare D1

### 優點
- ✅ 與 Cloudflare 生態系統深度整合
- ✅ 全球分佈式資料庫
- ✅ 免費額度慷慨
- ✅ 零配置（在 Cloudflare 內）

### 缺點
- ❌ SQLite 語法（功能較少）
- ❌ 較新的產品，生態系統較小
- ❌ 有些 PostgreSQL 功能不支援
- ❌ 遷移工具較少

## Neon PostgreSQL

### 優點
- ✅ 完整的 PostgreSQL 功能
- ✅ 成熟的生態系統和工具
- ✅ 更好的查詢優化器
- ✅ 支援複雜的 JOIN 和子查詢
- ✅ JSON/JSONB 支援更好
- ✅ 豐富的擴展功能
- ✅ 更多的 ORM 和工具支援

### 缺點
- ❌ 需要額外配置連接字串
- ❌ 不是 Cloudflare 原生服務
- ❌ 可能有輕微的延遲（取決於區域）

## 決策理由

選擇 Neon 的主要原因：

1. **PostgreSQL 生態系統**: 更成熟的工具鏈和社群支援
2. **功能完整性**: 支援更複雜的查詢和資料類型
3. **未來擴展性**: 如果需要遷移到其他 PostgreSQL 服務更容易
4. **開發體驗**: 更多的 GUI 工具和除錯選項
5. **效能**: PostgreSQL 的查詢優化器更強大

## 效能考量

- **D1**: 全球分佈，讀取延遲極低
- **Neon**: 單區域，但對於 B2B 詢價系統來說延遲可接受（通常 < 100ms）

對於詢價系統這種寫入不頻繁的應用，Neon 的效能完全足夠。

## 成本比較

### D1 免費額度
- 5GB 儲存
- 每天 500 萬次讀取
- 每天 10 萬次寫入

### Neon 免費額度
- 0.5GB 儲存
- 無限查詢
- 3 個專案

對於中小型專案，兩者的免費額度都足夠使用。

## 遷移路徑

如果未來需要從 Neon 遷移到 D1：

1. 調整 SQL 語法（PostgreSQL → SQLite）
2. 更新連接邏輯
3. 執行資料遷移

如果需要從 Neon 遷移到其他 PostgreSQL：

1. 使用 `pg_dump` 匯出資料
2. 更新連接字串
3. 幾乎不需要修改程式碼

## 結論

對於本專案，Neon 提供了更好的開發體驗和未來擴展性，是更合適的選擇。
